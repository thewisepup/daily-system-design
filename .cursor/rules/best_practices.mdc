---
description: Core best practices for code quality, security, performance, and maintainability - always applied
alwaysApply: true
---

# Best Practices

**Use pnpm** for all dependency management. Never npm or yarn.

## Code Quality

- **DRY**: Extract repeated logic into reusable functions/components/utilities
- **SOLID**: Single responsibility, depend on abstractions, focused interfaces
- **Clean Code**: Self-documenting names, small focused functions, max 2-3 nesting levels, early returns, pure functions when possible
- **No magic numbers**: Use named constants (`const MAX_RETRIES = 3`)
- **No inline comments** unless JSDoc, complex business logic, or non-obvious workarounds

## Security

- Validate all inputs with Zod schemas; never trust client-side validation
- Use `adminProcedure` for protected endpoints
- Never log sensitive data (passwords, tokens, PII)
- Use environment variables for secrets

## Performance

- **React/Next.js**: Server Components by default, `dynamic` imports for heavy components, `next/image` for images, memoize only when needed
- **Drizzle/PostgreSQL**: Index frequently queried columns, batch mutations, paginate large lists, select only needed fields, avoid N+1 queries

## Error Handling

- Use try-catch for async operations with meaningful error messages
- Use `TRPCError` with proper codes (UNAUTHORIZED, BAD_REQUEST, CONFLICT, NOT_FOUND)
- Log errors server-side; don't expose sensitive info to clients

## Components

- Keep under 150 lines; extract complex logic to hooks/utilities
- Compose focused, single-purpose components
- Include own state and error handling

## TypeScript

- Strict mode; avoid `any` (use `unknown` + type guards)
- Use Drizzle types: `$inferSelect`, `$inferInsert`
- Use `import type` for type-only imports
- Explicit return types for exported functions

## Code Organization

- Group imports: external → internal → types
- Separate concerns: UI, business logic, data access
- Keep related code together

## Testing

**Tests MUST be updated with code changes.** See `.cursor/rules/testing.mdc` for complete testing practices.

## Accessibility & Documentation

- Semantic HTML, alt text, keyboard navigation, proper heading hierarchy
- JSDoc for exported functions; document complex business logic

